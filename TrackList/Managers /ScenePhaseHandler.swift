//
//  ScenePhaseHandler.swift
//  TrackList
//
//  –ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤–∫–ª–∞–¥–æ–∫ (TabView):
//  ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É,
//  ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–±–æ—Ä –≤–∫–ª–∞–¥–∫–∏,
//  ‚Äî —É–≤–µ–¥–æ–º–ª—è–µ—Ç —ç–∫—Ä–∞–Ω—ã –æ —Å–º–µ–Ω–µ –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏.
//
//  –ù–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–æ–≤.
//  –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ñ–æ–Ω–æ—Ç–µ–∫–∏ ‚Äî –≤ NavigationCoordinator.
//
//  Created by Pavel Fomin on 02.11.2025.
//

import Foundation
import Combine

@MainActor
final class ScenePhaseHandler: ObservableObject {

    // MARK: - Singleton

    static let shared = ScenePhaseHandler()
    private init() {}

    // MARK: - –í—Å–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

    enum Tab: Hashable {
        case player
        case library
        case tracklists
        case settings
        case search          // –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    }

    // MARK: - –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞

    /// –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    /// –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–±–æ—Ä–µ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–∏ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ repeatedTabSelection.
    @Published var activeTab: Tab = .library {
        didSet {
            if oldValue == activeTab {
                // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–±–æ—Ä –≤–∫–ª–∞–¥–∫–∏
                repeatedTabSelection = activeTab
                print("üîÅ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É: \(activeTab)")
            } else {
                // –û–±—ã—á–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
                repeatedTabSelection = nil
                print("üß≠ –ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É: \(activeTab)")
            }
        }
    }

    // MARK: - –°–æ–±—ã—Ç–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–∫–ª–∞–¥–∫–∏

    /// –≠–∫—Ä–∞–Ω—ã –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ,
    /// —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–∫—Ä–æ–ª–ª –≤ –Ω–∞—á–∞–ª–æ, –∑–∞–∫—Ä—ã—Ç–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ –∏ —Ç.–ø.).
    @Published var repeatedTabSelection: Tab? = nil
}
